<script src="https://prod-cdn.superblocks.com/packages/@superblocksteam/embed@latest/embed.bundle.js"></script>
<script>
  // Embed the Superblocks app
  const sbApp = Superblocks.createSuperblocksEmbed({
    src: "https://app.superblocks.com/embed/applications/a6bc8e63-fe6d-4303-8467-3add244e916f",
  });

  // Wait for the DOM to be ready before appending
  window.onload = function () {
    document.body.appendChild(sbApp); // Ensure the body is ready
  };

  // Listen for messages from the embedded app
  window.addEventListener("message", (event) => {
    // Log the message event to see if it's working
    console.log("Received message:", event); // Log full event object
    console.log("event.data:", event.data); // Log event.data to inspect its structure

    // Ensure the message is coming from the correct Superblocks app
    if (event.origin !== "https://app.superblocks.com") {
      console.log("Message origin not trusted:", event.origin);
      return;
    }

    // Check if the action is "taskAdded"
    if (event.data && event.data.action === "taskAdded") {
      console.log("Received message from embedded app:", event.data.message);

      // If the message is nested, use the appropriate structure
      const message = event.data.message || event.data.data?.message; // Check both potential structures

      // Create and display the message in the parent app
      const messageElement = document.createElement("p");
      messageElement.textContent = message; // Should be "hello"
      document.body.appendChild(messageElement); // Add it to the DOM
    }
  });
</script>
