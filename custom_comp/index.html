<script src="https://prod-cdn.superblocks.com/packages/@superblocksteam/embed@latest/embed.bundle.js"></script>
<script>
  // Embed the Superblocks app
  const sbApp = Superblocks.createSuperblocksEmbed({
    src: "https://app.superblocks.com/embed/applications/a6bc8e63-fe6d-4303-8467-3add244e916f",
  });

  // Wait for the DOM to be ready before appending
  window.onload = function () {
    console.log("Parent app is ready.");
    document.body.appendChild(sbApp); // Ensure the body is ready
  };

  // Listen for messages from the embedded app
  window.addEventListener("message", (event) => {
    console.log("Received message event:", JSON.stringify(event.data, null, 2));

    // Verify the origin of the message
    if (event.origin !== "https://app.superblocks.com") {
      console.warn("Untrusted origin:", event.origin);
      return;
    }

    // Validate the structure of event.data
    if (
      !event.data ||
      typeof event.data.action !== "string" ||
      typeof event.data.message !== "string"
    ) {
      console.warn(
        "Invalid message structure:",
        JSON.stringify(event.data, null, 2)
      );
      return;
    }

    // Handle the "taskAdded" action
    if (event.data.action === "taskAdded") {
      console.log("Task added message received:", event.data.message);

      // Display the message in the DOM
      const messageElement = document.createElement("p");
      messageElement.textContent = event.data.message;
      document.body.appendChild(messageElement);
    } else {
      console.warn(
        "Unexpected message format or action:",
        JSON.stringify(event.data, null, 2)
      );
    }
  });
</script>
